# Apache 2.4 – full vhost for latencypoison.rootsolve.org
# Copy to /etc/apache2/sites-available/, then a2ensite, systemctl reload apache2
# Requires: a2enmod proxy proxy_http ssl headers rewrite

# --- Port 80: redirect to HTTPS
<VirtualHost *:80>
    ServerName latencypoison.rootsolve.org
    Redirect permanent / https://latencypoison.rootsolve.org/
</VirtualHost>

# --- Port 443: app + API + Go proxy
<VirtualHost *:443>
    ServerName latencypoison.rootsolve.org

    SSLEngine on
    SSLCertificateFile      /path/to/fullchain.pem
    SSLCertificateKeyFile   /path/to/privkey.pem

    ProxyPreserveHost On

    # API (FastAPI, port 8000)
    ProxyPass /api http://127.0.0.1:8000/api
    ProxyPassReverse /api http://127.0.0.1:8000/api

    # Go proxy: use /proxy/ (trailing slash) so backend gets /health not //health
    <Location /proxy/>
        SetEnv proxy-nokeepalive 1
        SetEnv proxy-initial-not-pooled 1
        ProxyPass http://127.0.0.1:8082/ disablereuse=on
        ProxyPassReverse http://127.0.0.1:8082/
    </Location>

    # Frontend (React, port 3000) – last
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
</VirtualHost>
